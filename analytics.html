<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard | Immobilien-Funnel</title>
    <style>
        .auth-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
            background: #0a1628;
            color: white;
        }
        .auth-screen h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #c9a35b;
        }
        .auth-screen input {
            background: #152a47;
            border: 2px solid #1e3a5f;
            color: #fff;
            padding: 16px 24px;
            border-radius: 8px;
            width: 320px;
            margin-bottom: 20px;
            font-size: 16px;
            font-family: inherit;
        }
        .auth-screen input:focus {
            outline: none;
            border-color: #c9a35b;
        }
        .auth-screen button {
            background: #c9a35b;
            color: #0a1628;
            border: none;
            padding: 16px 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
        }
        .auth-screen button:hover {
            background: #e4d4b4;
        }
        .auth-screen .error {
            color: #ef4444;
            margin-top: 20px;
            display: none;
        }
        .auth-screen .hint {
            color: #8b9cb8;
            margin-top: 15px;
            font-size: 14px;
        }
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a1628;
            color: white;
            padding: 40px 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            font-size: 32px;
            margin-bottom: 40px;
            color: #c9a35b;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: #152a47;
            padding: 24px;
            border-radius: 8px;
            border-left: 4px solid #c9a35b;
        }
        
        .stat-label {
            font-size: 14px;
            color: #8b9cb8;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: white;
            margin-bottom: 4px;
        }
        
        .stat-subtitle {
            font-size: 14px;
            color: #8b9cb8;
        }
        
        .funnel-visual {
            background: #152a47;
            padding: 40px;
            border-radius: 8px;
            margin-bottom: 40px;
        }
        
        .funnel-step {
            margin-bottom: 24px;
        }
        
        .funnel-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .funnel-bar-container {
            height: 40px;
            background: #0a1628;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        .funnel-bar {
            height: 100%;
            background: linear-gradient(90deg, #152a47 0%, #c9a35b 100%);
            display: flex;
            align-items: center;
            padding-left: 16px;
            font-weight: 600;
            transition: width 0.3s;
        }
        
        .leads-table {
            background: #152a47;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .table-header {
            background: #0a1628;
            padding: 20px;
            font-size: 18px;
            font-weight: 600;
        }
        
        .table-body {
            padding: 20px;
        }
        
        .lead-row {
            display: grid;
            grid-template-columns: 2fr 2fr 2fr 1fr 1fr;
            gap: 16px;
            padding: 16px;
            border-bottom: 1px solid #1e3a5f;
            align-items: center;
        }
        
        .lead-row:last-child {
            border-bottom: none;
        }
        
        .lead-name {
            font-weight: 600;
        }
        
        .lead-score {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .score-high { background: #10b981; color: white; }
        .score-medium { background: #f59e0b; color: white; }
        .score-low { background: #6b7280; color: white; }
        
        .refresh-btn {
            background: #c9a35b;
            color: #0a1628;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        .refresh-btn:hover {
            background: #e4d4b4;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #8b9cb8;
        }
    </style>
</head>
<body>
    <div id="auth" class="auth-screen">
        <h1>ðŸ”’ Analytics Dashboard</h1>
        <p style="color: #8b9cb8; margin-bottom: 30px;">Zugriff nur fÃ¼r autorisierte Benutzer</p>
        <input type="password" id="tokenInput" placeholder="Access Token" onkeypress="if(event.key==='Enter')authenticate()">
        <button onclick="authenticate()">Login</button>
        <div class="error" id="errorMsg">Falscher Token! Zugriff verweigert.</div>
        <div class="hint">Token via URL: ?token=DEIN_TOKEN</div>
    </div>
    
    <div id="app" class="container" style="display: none;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px;">
            <h1 style="margin: 0;">ðŸ“Š Immobilien-Funnel Analytics</h1>
            <button onclick="logout()" style="background: #6b7280; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">Logout</button>
        </div>
        
        <button class="refresh-btn" onclick="loadAnalytics()">ðŸ”„ Aktualisieren</button>
        
        <!-- Key Metrics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Landingpage Views</div>
                <div class="stat-value" id="stat-views">-</div>
                <div class="stat-subtitle">Gesamt</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Quiz Starts</div>
                <div class="stat-value" id="stat-quiz-starts">-</div>
                <div class="stat-subtitle"><span id="conv-quiz">-</span>% Conversion</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Quiz Completion</div>
                <div class="stat-value" id="stat-quiz-complete">-</div>
                <div class="stat-subtitle"><span id="conv-complete">-</span>% von Starts</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Leads</div>
                <div class="stat-value" id="stat-leads">-</div>
                <div class="stat-subtitle"><span id="conv-lead">-</span>% von Complete</div>
            </div>
        </div>
        
        <!-- Funnel Visualization -->
        <div class="funnel-visual">
            <h2 style="margin-bottom: 24px; font-size: 20px;">Conversion Funnel</h2>
            
            <div class="funnel-step">
                <div class="funnel-label">
                    <span>Landingpage View</span>
                    <span id="funnel-views">-</span>
                </div>
                <div class="funnel-bar-container">
                    <div class="funnel-bar" id="bar-views" style="width: 100%">100%</div>
                </div>
            </div>
            
            <div class="funnel-step">
                <div class="funnel-label">
                    <span>Quiz Start</span>
                    <span id="funnel-quiz-starts">-</span>
                </div>
                <div class="funnel-bar-container">
                    <div class="funnel-bar" id="bar-quiz-starts" style="width: 0%">0%</div>
                </div>
            </div>
            
            <div class="funnel-step">
                <div class="funnel-label">
                    <span>Quiz Complete</span>
                    <span id="funnel-quiz-complete">-</span>
                </div>
                <div class="funnel-bar-container">
                    <div class="funnel-bar" id="bar-quiz-complete" style="width: 0%">0%</div>
                </div>
            </div>
            
            <div class="funnel-step">
                <div class="funnel-label">
                    <span>Lead Submit</span>
                    <span id="funnel-leads">-</span>
                </div>
                <div class="funnel-bar-container">
                    <div class="funnel-bar" id="bar-leads" style="width: 0%">0%</div>
                </div>
            </div>
        </div>
        
        <!-- Leads Table -->
        <div class="leads-table">
            <div class="table-header">Letzte Leads</div>
            <div class="table-body" id="leads-table">
                <div class="no-data">Noch keine Leads vorhanden</div>
            </div>
        </div>
    </div>
    
    <script>
        // ==================== TOKEN AUTH ====================
        const VALID_TOKEN = 'immobilien_2026_samu'; // Ã„NDERN: Setze deinen Token
        
        // Check auth on page load
        const urlParams = new URLSearchParams(window.location.search);
        let token = urlParams.get('token') || localStorage.getItem('analytics_token');
        
        if (token === VALID_TOKEN) {
            localStorage.setItem('analytics_token', token);
            document.getElementById('auth').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            loadAnalytics();
        }
        
        function authenticate() {
            const inputToken = document.getElementById('tokenInput').value;
            if (inputToken === VALID_TOKEN) {
                localStorage.setItem('analytics_token', inputToken);
                document.getElementById('auth').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                loadAnalytics();
            } else {
                document.getElementById('errorMsg').style.display = 'block';
            }
        }
        
        function logout() {
            localStorage.removeItem('analytics_token');
            location.reload();
        }
        
        // ==================== ANALYTICS ====================
        // Load from localStorage (for now - spÃ¤ter von Backend/DB)
        function loadAnalytics() {
            const analytics = JSON.parse(localStorage.getItem('funnel_analytics') || '{"views":0,"quizStarts":0,"quizComplete":0,"leads":[],"leadsList":[]}');
            
            // Update stats
            document.getElementById('stat-views').textContent = analytics.views || 0;
            document.getElementById('stat-quiz-starts').textContent = analytics.quizStarts || 0;
            document.getElementById('stat-quiz-complete').textContent = analytics.quizComplete || 0;
            document.getElementById('stat-leads').textContent = analytics.leads || 0;
            
            // Calculate conversions
            const convQuiz = analytics.views > 0 ? Math.round((analytics.quizStarts / analytics.views) * 100) : 0;
            const convComplete = analytics.quizStarts > 0 ? Math.round((analytics.quizComplete / analytics.quizStarts) * 100) : 0;
            const convLead = analytics.quizComplete > 0 ? Math.round((analytics.leads / analytics.quizComplete) * 100) : 0;
            
            document.getElementById('conv-quiz').textContent = convQuiz;
            document.getElementById('conv-complete').textContent = convComplete;
            document.getElementById('conv-lead').textContent = convLead;
            
            // Update funnel bars
            document.getElementById('funnel-views').textContent = analytics.views || 0;
            document.getElementById('funnel-quiz-starts').textContent = analytics.quizStarts || 0;
            document.getElementById('funnel-quiz-complete').textContent = analytics.quizComplete || 0;
            document.getElementById('funnel-leads').textContent = analytics.leads || 0;
            
            const baseViews = analytics.views || 1;
            document.getElementById('bar-quiz-starts').style.width = ((analytics.quizStarts / baseViews) * 100) + '%';
            document.getElementById('bar-quiz-starts').textContent = convQuiz + '%';
            document.getElementById('bar-quiz-complete').style.width = ((analytics.quizComplete / baseViews) * 100) + '%';
            document.getElementById('bar-quiz-complete').textContent = Math.round((analytics.quizComplete / baseViews) * 100) + '%';
            document.getElementById('bar-leads').style.width = ((analytics.leads / baseViews) * 100) + '%';
            document.getElementById('bar-leads').textContent = Math.round((analytics.leads / baseViews) * 100) + '%';
            
            // Update leads table
            if (analytics.leadsList && analytics.leadsList.length > 0) {
                const tableHtml = analytics.leadsList.reverse().slice(0, 20).map(lead => {
                    const scoreClass = lead.score >= 12 ? 'score-high' : lead.score >= 8 ? 'score-medium' : 'score-low';
                    return `
                        <div class="lead-row">
                            <div class="lead-name">${lead.firstName}</div>
                            <div>${lead.email}</div>
                            <div>${lead.phone}</div>
                            <div><span class="lead-score ${scoreClass}">${lead.score}</span></div>
                            <div style="font-size: 14px; color: #8b9cb8;">${new Date(lead.timestamp).toLocaleDateString('de-CH')}</div>
                        </div>
                    `;
                }).join('');
                document.getElementById('leads-table').innerHTML = tableHtml;
            }
        }
        
        // Load on page load
        loadAnalytics();
        
        // Auto-refresh every 30 seconds
        setInterval(loadAnalytics, 30000);
    </script>
</body>
</html>
